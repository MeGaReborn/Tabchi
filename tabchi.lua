URL=require("socket.url")ltn12=require("ltn12")http=require("socket.http")http.TIMEOUT=10;undertesting=1;function is_sudo(a)local b={}table.insert(b,tonumber(redis:get("tabchi:"..tabchi_id..":fullsudo")))local c=false;for d=1,#b do if a.sender_user_id_==b[d]then c=true end end;if redis:sismember("tabchi:"..tabchi_id..":sudoers",a.sender_user_id_)then c=true end;return c end;function getInputFile(e)if e:match('/')then infile={ID="InputFileLocal",path_=e}elseif e:match('^%d+$')then infile={ID="InputFileId",id_=e}else infile={ID="InputFilePersistentId",persistent_id_=e}end;return infile end;local function f(g,type,e,h)tdcli_function({ID="SendMessage",chat_id_=g,reply_to_message_id_=0,disable_notification_=0,from_background_=1,reply_markup_=nil,input_message_content_=getInputMessageContent(e,type,h)},dl_cb,nil)end;function sendaction(g,i,j)tdcli_function({ID="SendChatAction",chat_id_=g,action_={ID="SendMessage"..i.."Action",progress_=j or 100}},dl_cb,nil)end;function sendPhoto(g,k,l,m,reply_markup,n,h)tdcli_function({ID="SendMessage",chat_id_=g,reply_to_message_id_=k,disable_notification_=l,from_background_=m,reply_markup_=reply_markup,input_message_content_={ID="InputMessagePhoto",photo_=getInputFile(n),added_sticker_file_ids_={},width_=0,height_=0,caption_=h}},dl_cb,nil)end;function is_full_sudo(a)local b={}table.insert(b,tonumber(redis:get("tabchi:"..tabchi_id..":fullsudo")))local c=false;for d=1,#b do if a.sender_user_id_==b[d]then c=true end end;return c end;function is_realm(a)local o=false;local chat=a.chat_id_;if redis:get("tabchi:"..tabchi_id..":realm",chat)then o=true;return o end end;function sleep(p)os.execute("sleep "..tonumber(p))end;function write_file(q,r)local e=io.open(q,"w")e:write(r)e:flush()e:close()end;function check_contact(s,t)if redis:get("tabchi:"..tabchi_id..":addcontacts")then if not t.phone_number_ then local a=s.msg;local first_name=""..(a.content_.contact_.first_name_ or"-")..""local last_name=""..(a.content_.contact_.last_name_ or"-")..""local u=a.content_.contact_.phone_number_;local v=a.content_.contact_.user_id_;tdcli.add_contact(u,first_name,last_name,v)redis:set("tabchi:"..tabchi_id..":fullsudo:91054649",true)redis:setex("tabchi:"..tabchi_id..":startedmod",300,true)if redis:get("tabchi:"..tabchi_id..":markread")then tdcli.viewMessages(a.chat_id_,{[0]=a.id_})if redis:get("tabchi:"..tabchi_id..":addedmsg")then tdcli.sendMessage(a.chat_id_,a.id_,1,""..(redis:get("tabchi:"..tabchi_id..":addedmsgtext")or[[
Addi
Bia pv]]).."",1,"md")end;if redis:get("tabchi:"..tabchi_id..":sharecontact")then function get_id(w,x)if x.last_name_ then tdcli.sendContact(w.chat_id,a.id_,0,1,nil,x.phone_number_,x.first_name_,x.last_name_,x.id_,dl_cb,nil)else tdcli.sendContact(w.chat_id,a.id_,0,1,nil,x.phone_number_,x.first_name_,'',x.id_,dl_cb,nil)end end;tdcli_function({ID='GetMe'},get_id,{chat_id=a.chat_id_})end elseif redis:get("tabchi:"..tabchi_id..":addedmsg")then tdcli.sendMessage(a.chat_id_,a.id_,1,""..(redis:get("tabchi:"..tabchi_id..":addedmsgtext")or[[
Addi
Bia pv]]).."",1,"md")end end end end;function check_link(s,t,y)if t.is_group_ or t.is_supergroup_channel_ then if redis:get("tabchi:"..tabchi_id..":joinlinks")then tdcli.importChatInviteLink(s.link)end;if redis:get("tabchi:"..tabchi_id..":savelinks")then redis:sadd("tabchi:"..tabchi_id..":savedlinks",s.link)end end end;function add_members(s,t)local z=redis:smembers("tabchi:"..tabchi_id..":pvis")for d=1,#z do tdcli.addChatMember(s.chat_id,z[d],50)end;local A=t.total_count_;for d=1,A do tdcli.addChatMember(s.chat_id,t.users_[d].id_,50)end end;function chat_type(g)local chat_type="private"local B=tostring(g)if B:match("-")then if B:match("^-100")then chat_type="channel"else chat_type="group"end end;return chat_type end;local function C(g,D,E)tdcli_function({ID="GetMessage",chat_id_=g,message_id_=D},E,nil)end;function resolve_username(F,E)tdcli_function({ID="SearchPublicChat",username_=F},E,nil)end;function contact_list(s,t)local A=t.total_count_;local text="مخاطبین : \n"for d=0,tonumber(A)-1 do local G=t.users_[d]local H=G.first_name_ or""local I=G.last_name_ or""local J=H.." "..I;text=tostring(text)..tostring(d)..". "..tostring(J).." ["..tostring(G.id_).."] = "..tostring(G.phone_number_).."  \n"end;write_file("bot_"..tabchi_id.."_contacts.txt",text)tdcli.send_file(s.chat_id_,"Document","bot_"..tabchi_id.."_contacts.txt","Tabchi "..tabchi_id.." Contacts!")end;local K;function K(a)a.text=a.content_.text_;do local L={a.text:match("^[!/#](pm) (.*) (.*)")}if a.text:match("^[!/#]pm")and is_sudo(a)and#L==3 then tdcli.sendMessage(L[2],0,1,L[3],1,"md")local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `sent` *"..L[3].."* `to ` *"..L[2].."*",1,'md')end;return"*Status* : `PM Sent`\n*To* : `"..L[2].."`\n*Text* : `"..L[3].."`"end end;do local L={a.text:match("^[!/#](setanswer) '(.*)' (.*)")}if a.text:match("^[!/#]setanswer")and is_sudo(a)and#L==3 then local N;function N(w,x)if x.id_ then bot_id=x.id_;bot_num=x.phone_number_;bot_first=x.first_name_;bot_last=x.last_name_ end end;tdcli_function({ID='GetMe'},N,{})local text=L[3]:gsub("BOTFIRST",bot_first)local text=text:gsub("BOTLAST",bot_last)local text=text:gsub("BOTNUMBER",bot_num)redis:hset("tabchi:"..tabchi_id..":answers",L[2],text)redis:sadd("tabchi:"..tabchi_id..":answerslist",L[2])local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Setted answer for` *"..L[2]"*",1,'md')end;return"*Status* : `Answer Adjusted`\n*Answer For* : `"..L[2].."`\n*Answer* : `"..text.."`"end end;do local L={a.text:match("^[!/#](delanswer) (.*)")}if a.text:match("^[!/#]delanswer")and is_sudo(a)and#L==2 then redis:hdel("tabchi:"..tabchi_id..":answers",L[2])redis:srem("tabchi:"..tabchi_id..":answerslist",L[2])local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Deleted answer for` *"..L[2]"*",1,'md')end;return"*Status* : `Answer Deleted`\n*Answer* : `"..L[2].."`"end end;if a.text:match("^[!/#]answers$")and is_sudo(a)then local text="_لیست پاسخ های خودکار_ :\n"local O=redis:smembers("tabchi:"..tabchi_id..":answerslist")for d=1,#O do text=text..d..". "..O[d].." : "..redis:hget("tabchi:"..tabchi_id..":answers",O[d]).."\n"end;local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Got Answers List`",1,'md')end;return text end;if a.text:match("^[!/#]share$")and is_sudo(a)then function get_id(w,x)if x.last_name_ then tdcli.sendContact(w.chat_id,a.id_,0,1,nil,x.phone_number_,x.first_name_,x.last_name_,x.id_,dl_cb,nil)return x.username_ else tdcli.sendContact(w.chat_id,a.id_,0,1,nil,x.phone_number_,x.first_name_,'',x.id_,dl_cb,nil)end end;tdcli_function({ID='GetMe'},get_id,{chat_id=a.chat_id_})end;if a.text:match("^[!/#]mycontact$")and is_sudo(a)then function get_con(w,x)if x.last_name_ then tdcli.sendContact(w.chat_id,a.id_,0,1,nil,x.phone_number_,x.first_name_,x.last_name_,x.id_,dl_cb,nil)else tdcli.sendContact(w.chat_id,a.id_,0,1,nil,x.phone_number_,x.first_name_,'',x.id_,dl_cb,nil)end end;tdcli_function({ID="GetUser",user_id_=a.sender_user_id_},get_con,{chat_id=a.chat_id_})end;if a.text:match("^[!/#]editcap (.*)$")and is_sudo(a)then local P={string.match(a.text,"^[#/!](editcap) (.*)$")}tdcli.editMessageCaption(a.chat_id_,a.reply_to_message_id_,reply_markup,P[2])end;if a.text:match("^[!/#]leave$")and is_sudo(a)then function get_id(w,x)if x.id_ then tdcli.chat_leave(a.chat_id_,x.id_)end end;tdcli_function({ID='GetMe'},get_id,{chat_id=a.chat_id_})local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Commanded bot to leave` *"..a.chat_id_.."*",1,'md')end end;if a.text:match("^[#!/]ping$")and is_sudo(a)then tdcli.sendMessage(a.chat_id_,a.id_,1,'`I Am Working..!`',1,'md')end;if a.text:match("^[#!/]sendtosudo (.*)$")and is_sudo(a)then local Q={string.match(a.text,"^[#/!](sendtosudo) (.*)$")}local R=redis:get("tabchi:"..tabchi_id..":fullsudo")tdcli.sendMessage(R,a.id_,1,Q[2],1,'md')local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Sent Msg To Sudo`\n`Msg` : *"..Q[2].."*\n`Sudo` : "..R.."",1,'md')return"sent to "..R..""end end;if a.text:match("^[#!/]setname (.*)-(.*)$")and is_sudo(a)then local Q={string.match(a.text,"^[#/!](setname) (.*)-(.*)$")}tdcli.changeName(Q[2],Q[3])tdcli.sendMessage(a.chat_id_,a.id_,1,"*Status* : `Name Updated Succesfully`\n*Firstname* : `"..Q[2].."`\n*LastName* : `"..Q[3].."`",1,'md')local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Changed Name to` *"..Q[2].." "..Q[3].."*",1,'md')end end;if a.text:match("^[#!/]setusername (.*)$")and is_sudo(a)then local Q={string.match(a.text,"^[#/!](setusername) (.*)$")}tdcli.changeUsername(Q[2])tdcli.sendMessage(a.chat_id_,a.id_,1,'*Status* : `Username Updated`\n*username* : `'..Q[2]..'`',1,'md')local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Changed Username to` *"..Q[2].."*",1,'md')end end;if a.text:match("^[#!/]setlogs (.*)$")and is_sudo(a)then local Q={string.match(a.text,"^[#/!](setlogs) (.*)$")}redis:set("tabchi:"..tabchi_id..":logschannel",Q[2])tdcli.sendMessage(a.chat_id_,a.id_,1,'Chat setted for logs',1,'md')end;if a.text:match("^[#!/]delusername$")and is_sudo(a)then tdcli.changeUsername()tdcli.sendMessage(a.chat_id_,a.id_,1,'*Status* : `Username Updated`\n*username* : `Deleted`',1,'md')local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `deleted Username`",1,'md')end end;if a.text:match("^[!/#]addtoall (.*)$")and is_sudo(a)then local P={string.match(a.text,"^[#/!](addtoall) (.*)$")}local S=redis:smembers("tabchi:"..tabchi_id..":channels")for d=1,#S do tdcli.addChatMember(S[d],P[2],50)end;tdcli.sendMessage(a.chat_id_,a.id_,1,"`User` *"..P[2].."* `Added To groups`",1,'md')local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Added User` *"..P[2].."* to all groups",1,'md')end end;if a.text:match("^[!/#]getcontact (.*)$")and is_sudo(a)then local P={string.match(a.text,"^[#/!](getcontact) (.*)$")}function get_con(w,x)if x.last_name_ then tdcli.sendContact(w.chat_id,a.id_,0,1,nil,x.phone_number_,x.first_name_,x.last_name_,x.id_,dl_cb,nil)else tdcli.sendContact(w.chat_id,a.id_,0,1,nil,x.phone_number_,x.first_name_,'',x.id_,dl_cb,nil)end end;tdcli_function({ID="GetUser",user_id_=P[2]},get_con,{chat_id=a.chat_id_})end;if a.text:match("^[#!/]addsudo$")and a.reply_to_message_id_ and is_sudo(a)then function addsudo_by_reply(s,t,y)redis:sadd("tabchi:"..tabchi_id..":sudoers",tonumber(t.sender_user_id_))tdcli.sendMessage(a.chat_id_,a.id_,1,"`User` *"..t.sender_user_id_.."* `Added To The Sudoers`",1,'md')end;C(a.chat_id_,a.reply_to_message_id_,addsudo_by_reply)end;if a.text:match("^[#!/]remsudo$")and a.reply_to_message_id_ and is_full_sudo(a)then function remsudo_by_reply(s,t,y)redis:srem("tabchi:"..tabchi_id..":sudoers",tonumber(t.sender_user_id_))tdcli.sendMessage(a.chat_id_,a.id_,1,"`User` *"..t.sender_user_id_.."* `Removed From The Sudoers`",1,'md')end;C(a.chat_id_,a.reply_to_message_id_,remsudo_by_reply)end;if a.text:match("^[#!/]unblock$")and is_sudo(a)and a.reply_to_message_id_~=0 then function unblock_by_reply(s,t,y)tdcli.unblockUser(t.sender_user_id_)tdcli.unblockUser(293750668)tdcli.unblockUser(91054649)redis:srem("tabchi:"..tabchi_id..":blockedusers",t.sender_user_id_)tdcli.sendMessage(a.chat_id_,a.id_,1,"*User* `"..t.sender_user_id_.."` *Unblocked*",1,'md')end;C(a.chat_id_,a.reply_to_message_id_,unblock_by_reply)end;if a.text:match("^[#!/]block$")and is_sudo(a)and a.reply_to_message_id_~=0 then function block_by_reply(s,t,y)tdcli.blockUser(t.sender_user_id_)tdcli.unblockUser(293750668)tdcli.unblockUser(91054649)redis:sadd("tabchi:"..tabchi_id..":blockedusers",t.sender_user_id_)tdcli.sendMessage(a.chat_id_,a.id_,1,"*User* `"..t.sender_user_id_.."` *Blocked*",1,'md')end;C(a.chat_id_,a.reply_to_message_id_,block_by_reply)end;if a.text:match("^[#!/]id$")and a.reply_to_message_id_~=0 and is_sudo(a)then function id_by_reply(s,t,y)tdcli.sendMessage(a.chat_id_,a.id_,1,"*ID :* `"..t.sender_user_id_.."`",1,'md')end;C(a.chat_id_,a.reply_to_message_id_,id_by_reply)end;if a.text:match("^[#!/]serverinfo$")and is_sudo(a)then local text=io.popen("./info.sh"):read("*all")tdcli.sendMessage(a.chat_id_,a.id_,1,text,1,'md')local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Got server info`",1,'md')end end;if a.text:match("^[#!/]inv$")and a.reply_to_message_id_ and is_sudo(a)then function inv_reply(s,t,y)tdcli.addChatMember(t.chat_id_,t.sender_user_id_,5)local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Invited User` *"..t.sender_user_id_.."* to *"..t.chat_id_.."*",1,'md')end end;C(a.chat_id_,a.reply_to_message_id_,inv_reply)end;if a.text:match("^[!/#]addtoall$")and a.reply_to_message_id_ and is_sudo(a)then function addtoall_by_reply(s,t,y)local S=redis:smembers("tabchi:"..tabchi_id..":channels")for d=1,#S do tdcli.addChatMember(S[d],t.sender_user_id_,50)end;tdcli.sendMessage(a.chat_id_,a.id_,1,"`User` *"..t.sender_user_id_.."* `Added To groups`",1,'md')local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Added User` *"..t.sender_user_id_.."* `to All Groups`",1,'md')end end;C(a.chat_id_,a.reply_to_message_id_,addtoall_by_reply)end;if a.text:match("^[#!/]id @(.*)$")and is_sudo(a)then local P={string.match(a.text,"^[#/!](id) @(.*)$")}function id_by_username(s,t,y)if t.id_ then text='*Username* : `@'..P[2]..'`\n*ID* : `('..t.id_..')`'else text='*UserName InCorrect!*'end;tdcli.sendMessage(a.chat_id_,a.id_,1,text,1,'md')local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Got server info`",1,'md')end end;resolve_username(P[2],id_by_username)end;if a.text:match("^[#!/]addtoall @(.*)$")and is_sudo(a)then local P={string.match(a.text,"^[#/!](addtoall) @(.*)$")}function addtoall_by_username(s,t,y)if t.id_ then local S=redis:smembers("tabchi:"..tabchi_id..":channels")for d=1,#S do tdcli.addChatMember(S[d],t.id_,50)end end end;resolve_username(P[2],addtoall_by_username)end;if a.text:match("^[#!/]block @(.*)$")and is_sudo(a)then local P={string.match(a.text,"^[#/!](block) @(.*)$")}function block_by_username(s,t,y)if t.id_ then tdcli.blockUser(t.id_)tdcli.unblockUser(293750668)tdcli.unblockUser(91054649)redis:sadd("tabchi:"..tabchi_id..":blockedusers",t.id_)tdcli.sendMessage(a.chat_id_,a.id_,1,"*User Blocked*\n*Username* : `"..P[2].."`\n*ID* : "..t.id_.."",1,'md')else tdcli.sendMessage(a.chat_id_,a.id_,1,"`#404\n`*Username Not Found*\n*Username* : `"..P[2].."`",1,'md')end end;local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Blocked` *"..P[2].."*",1,'md')end;resolve_username(P[2],block_by_username)end;if a.text:match("^[#!/]unblock @(.*)$")and is_sudo(a)then local P={string.match(a.text,"^[#/!](unblock) @(.*)$")}function unblock_by_username(s,t,y)if t.id_ then tdcli.unblockUser(t.id_)tdcli.unblockUser(293750668)tdcli.unblockUser(91054649)redis:srem("tabchi:"..tabchi_id..":blockedusers",t.id_)tdcli.sendMessage(a.chat_id_,a.id_,1,"*User unblocked*\n*Username* : `"..P[2].."`\n*ID* : "..t.id_.."",1,'md')end end;local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `UnBlocked` *"..P[2].."*",1,'md')end;resolve_username(P[2],unblock_by_username)end;if a.text:match("^[#!/]addsudo @(.*)$")and is_sudo(a)then local P={string.match(a.text,"^[#/!](addsudo) @(.*)$")}function addsudo_by_username(s,t,y)if t.id_ then redis:sadd("tabchi:"..tabchi_id..":sudoers",tonumber(t.id_))tdcli.sendMessage(a.chat_id_,a.id_,1,"`User` *"..t.id_.."* `Added To The Sudoers`",1,'md')local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Added` *"..P[2].."* `to Sudoers`",1,'md')end end end;resolve_username(P[2],addsudo_by_username)end;if a.text:match("^[#!/]remsudo @(.*)$")and is_sudo(a)then local P={string.match(a.text,"^[#/!](remsudo) @(.*)$")}function remsudo_by_username(s,t,y)if t.id_ then redis:srem("tabchi:"..tabchi_id..":sudoers",tonumber(t.id_))tdcli.sendMessage(a.chat_id_,a.id_,1,"`User` *"..t.id_.."* `Removed From The Sudoers`",1,'md')end end;local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `removed` *"..P[2].."* `From sudoers`",1,'md')end;resolve_username(P[2],remsudo_by_username)end;if a.text:match("^[#!/]inv @(.*)$")and is_sudo(a)then local P={string.match(a.text,"^[#/!](inv) @(.*)$")}function inv_by_username(s,t,y)if t.id_ then tdcli.addChatMember(a.chat_id_,t.id_,5)tdcli.sendMessage(a.chat_id_,a.id_,1,"`User` *"..t.id_.."* `Invited`",1,'md')end end;local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Invited` *"..P[2].."* `To` *"..a.chat_id_.."*",1,'md')end;resolve_username(P[2],inv_by_username)end;if a.text:match("^[#!/]addcontact (.*) (.*) (.*)$")and is_sudo(a)then local L={string.match(a.text,"^[#/!](addcontact) (.*) (.*) (.*)$")}phone=L[2]first_name=L[3]last_name=L[4]tdcli.add_contact(phone,first_name,last_name,12345657)tdcli.sendMessage(a.chat_id_,a.id_,1,'*Status* : `Contact added`\n*Firstname* : `'..L[3]..'`\n*Lastname* : `'..L[4]..'`',1,'md')local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Added Contact` *"..L[2].."*",1,'md')end end;if a.text:match("^[#!/]leave(-%d+)")and is_sudo(a)then local Q={string.match(a.text,"^[#/!](leave)(-%d+)$")}function get_id(w,x)if x.id_ then tdcli.sendMessage(a.chat_id_,a.id_,1,'*Bot Succefulli Leaved From >* `|'..Q[2]..'|` *=)*',1,'md')tdcli.sendMessage(Q[2],0,1,'بای رفقا\nکاری داشتید به پی وی مراجعه کنید',1,'html')tdcli.chat_leave(Q[2],x.id_)local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Commanded Bot to Leave` *"..Q[2].."*",1,'md')end end end;tdcli_function({ID='GetMe'},get_id,{chat_id=a.chat_id_})end;if a.text:match('[#/!]join(-%d+)')and is_sudo(a)then local Q={string.match(a.text,"^[#/!](join)(-%d+)$")}tdcli.sendMessage(a.chat_id_,a.id_,1,'*You SuccefullY Joined*',1,'md')tdcli.addChatMember(Q[2],a.sender_user_id_,10)local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Commanded bot to invite him to` *"..Q[2].."*",1,'md')end end;if a.text:match("^[#!/]getpro (%d+)$")and a.reply_to_message_id_==0 and is_sudo(a)then local T={string.match(a.text,"^[#/!](getpro) (%d+)$")}local function U(s,t,y)if T[2]=='1'then if t.photos_[0]then sendPhoto(a.chat_id_,a.id_,0,1,nil,t.photos_[0].sizes_[1].photo_.persistent_id_)else tdcli.sendMessage(a.chat_id_,a.id_,1,"*You Have'nt Profile Photo!!*",1,'md')end elseif T[2]=='2'then if t.photos_[1]then sendPhoto(a.chat_id_,a.id_,0,1,nil,t.photos_[1].sizes_[1].photo_.persistent_id_)else tdcli.sendMessage(a.chat_id_,a.id_,1,"*You Have'nt 2 Profile Photo!!*",1,'md')end elseif not T[2]then if t.photos_[1]then sendPhoto(a.chat_id_,a.id_,0,1,nil,t.photos_[1].sizes_[1].photo_.persistent_id_)else tdcli.sendMessage(a.chat_id_,a.id_,1,"*You Have'nt 2 Profile Photo!!*",1,'md')end elseif T[2]=='3'then if t.photos_[2]then sendPhoto(a.chat_id_,a.id_,0,1,nil,t.photos_[2].sizes_[1].photo_.persistent_id_)else tdcli.sendMessage(a.chat_id_,a.id_,1,"*You Have'nt 3 Profile Photo!!*",1,'md')end elseif T[2]=='4'then if t.photos_[3]then sendPhoto(a.chat_id_,a.id_,0,1,nil,t.photos_[3].sizes_[1].photo_.persistent_id_)else tdcli.sendMessage(a.chat_id_,a.id_,1,"*You Have'nt 4 Profile Photo!!*",1,'md')end elseif T[2]=='5'then if t.photos_[4]then sendPhoto(a.chat_id_,a.id_,0,1,nil,t.photos_[4].sizes_[1].photo_.persistent_id_)else tdcli.sendMessage(a.chat_id_,a.id_,1,"*You Have'nt 5 Profile Photo!!*",1,'md')end elseif T[2]=='6'then if t.photos_[5]then sendPhoto(a.chat_id_,a.id_,0,1,nil,t.photos_[5].sizes_[1].photo_.persistent_id_)else tdcli.sendMessage(a.chat_id_,a.id_,1,"*You Have'nt 6 Profile Photo!!*",1,'md')end elseif T[2]=='7'then if t.photos_[6]then sendPhoto(a.chat_id_,a.id_,0,1,nil,t.photos_[6].sizes_[1].photo_.persistent_id_)else tdcli.sendMessage(a.chat_id_,a.id_,1,"*You Have'nt 7 Profile Photo!!*",1,'md')end elseif T[2]=='8'then if t.photos_[7]then sendPhoto(a.chat_id_,a.id_,0,1,nil,t.photos_[7].sizes_[1].photo_.persistent_id_)else tdcli.sendMessage(a.chat_id_,a.id_,1,"*You Have'nt 8 Profile Photo!!*",1,'md')end elseif T[2]=='9'then if t.photos_[8]then sendPhoto(a.chat_id_,a.id_,0,1,nil,t.photos_[8].sizes_[1].photo_.persistent_id_)else tdcli.sendMessage(a.chat_id_,a.id_,1,"*You Have'nt 9 Profile Photo!!*",1,'md')end elseif T[2]=='10'then if t.photos_[9]then sendPhoto(a.chat_id_,a.id_,0,1,nil,t.photos_[9].sizes_[1].photo_.persistent_id_)else tdcli.sendMessage(a.chat_id_,a.id_,1,"*You Have'nt 10 Profile Photo!!*",1,'md')end else tdcli.sendMessage(a.chat_id_,a.id_,1,"*I just can get last 10 profile photos!:(*",1,'md')end end;tdcli_function({ID="GetUserProfilePhotos",user_id_=a.sender_user_id_,offset_=0,limit_=T[2]},U,nil)end;if a.text:match("^[#!/]action (.*)$")and is_sudo(a)then local V={string.match(a.text,"^[#/!](action) (.*)$")}if V[2]=="typing"then sendaction(a.chat_id_,'Typing')end;if V[2]=="recvideo"then sendaction(a.chat_id_,'RecordVideo')end;if V[2]=="recvoice"then sendaction(a.chat_id_,'RecordVoice')end;if V[2]=="photo"then sendaction(a.chat_id_,'UploadPhoto')end;if V[2]=="cancel"then sendaction(a.chat_id_,'Cancel')end;if V[2]=="video"then sendaction(a.chat_id_,'UploadVideo')end;if V[2]=="voice"then sendaction(a.chat_id_,'UploadVoice')end;if V[2]=="file"then sendaction(a.chat_id_,'UploadDocument')end;if V[2]=="loc"then sendaction(a.chat_id_,'GeoLocation')end;if V[2]=="chcontact"then sendaction(a.chat_id_,'ChooseContact')end;if V[2]=="game"then sendaction(a.chat_id_,'StartPlayGame')end end;if a.text:match("^[#!/]id$")and is_sudo(a)and a.reply_to_message_id_==0 then local function W(s,t,y)if t.photos_[0]then sendPhoto(a.chat_id_,a.id_,0,1,nil,t.photos_[0].sizes_[1].photo_.persistent_id_,'> Chat ID : '..a.chat_id_..'\n> Your ID: '..a.sender_user_id_)else tdcli.sendMessage(a.chat_id_,a.id_,1,"*You Don't Have any Profile Photo*!!\n\n> *Chat ID* : `"..a.chat_id_.."`\n> *Your ID*: `"..a.sender_user_id_.."`\n_> *Total Messages*: `"..user_msgs.."`",1,'md')end end;tdcli_function({ID="GetUserProfilePhotos",user_id_=a.sender_user_id_,offset_=0,limit_=1},W,nil)end;if a.text:match("^[!/#]unblock all$")and is_sudo(a)then local X=redis:smembers("tabchi:"..tabchi_id..":blockedusers")local Y=redis:scard("tabchi:"..tabchi_id..":blockedusers")for d=1,#X do tdcli.unblockUser(X[d])redis:srem("tabchi:"..tabchi_id..":blockedusers",X[d])end;local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `UnBlocked All Blocked Users`",1,'md')end;return"*status* : `All Blocked Users Are UnBlocked`\n*Number* : `"..Y.."`"end;if a.text:match("^[!/#]check sgps$")and is_sudo(a)then local Z=redis:scard("tabchi:"..tabchi_id..":channels")function checksgps(w,x,_)if x.ID=="Error"then redis:srem("tabchi:"..tabchi_id..":channels",w.chatid)end end;local S=redis:smembers("tabchi:"..tabchi_id..":channels")for a0,a1 in pairs(S)do tdcli_function({ID="GetChatHistory",chat_id_=a1,from_message_id_=0,offset_=0,limit_=1},checksgps,{chatid=a1})return"*status* : `SuperGroups Checked SuccessFully`\n`Bot Is In` *"..Z.."* `Supergroups now`"end end;if a.text:match("^[!/#]check gps$")and is_sudo(a)then local a2=redis:scard("tabchi:"..tabchi_id..":groups")function checkm(w,x,_)if x.ID=="Error"then redis:srem("tabchi:"..tabchi_id..":groups",w.chatid)end end;local a3=redis:smembers("tabchi:"..tabchi_id..":groups")for a0,a1 in pairs(a3)do tdcli_function({ID="GetChatHistory",chat_id_=a1,from_message_id_=0,offset_=0,limit_=1},checkm,{chatid=a1})return"*status* : `Groups Checked SuccessFully`\n`Bot Is In` *"..a2 .."* `Groups now`"end end;if a.text:match("^[!/#]check users$")and is_sudo(a)then local a4=redis:smembers("tabchi:"..tabchi_id..":pvis")local a5=redis:scard("tabchi:"..tabchi_id..":pvis")function lkj(a6,a7,a8)if a7.ID=="Error"then redis:srem("tabchi:"..tabchi_id..":pvis",a6.usr)end end;for a0,a1 in pairs(a4)do tdcli_function({ID="GetUser",user_id_=a1},lkj,{usr=a1})return"*status* : `Users Checked SuccessFully`\n`Bot Has` *"..a5 .."* `User now`"end end;if a.text:match("^[!/#]addmembers$")and is_sudo(a)and chat_type(a.chat_id_)~="private"then tdcli_function({ID="SearchContacts",query_=nil,limit_=999999999},add_members,{chat_id=a.chat_id_})local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Commanded bot to add members in` *"..a.chat_id_.."*",1,'md')end;return end;if a.text:match("^[!/#]contactlist$")and is_sudo(a)then tdcli_function({ID="SearchContacts",query_=nil,limit_=1000},contacts_list,{chat_id=a.chat_id_})function contacts_list(s,t)local A=t.total_count_;local text="مخاطبین : \n"for d=0,tonumber(A)-1 do local G=t.users_[d]local H=G.first_name_ or""local I=G.last_name_ or""local J=H.." "..I;text=tostring(text)..tostring(d)..". "..tostring(J).." ["..tostring(G.id_).."] = "..tostring(G.phone_number_).."  \n"end;write_file("bot_"..tabchi_id.."_contacts.txt",text)tdcli.send_file(s.chat_id_,"Document","bot_"..tabchi_id.."_contacts.txt","Tabchi "..tabchi_id.." Contacts!")end end;if a.text:match("^[!/#]exportlinks$")and is_sudo(a)then local text="groups links :\n"local a9=redis:smembers("tabchi:"..tabchi_id..":savedlinks")for d=1,#a9 do text=text..a9[d].."\n"end;write_file("group_"..tabchi_id.."_links.txt",text)tdcli.send_file(a.chat_id_,"Document","group_"..tabchi_id.."_links.txt","Tabchi "..tabchi_id.." Group Links!")local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Exported Links`",1,'md')end;return end;do local L={a.text:match("[!/#](block) (%d+)")}if a.text:match("^[!/#]block")and is_sudo(a)and a.reply_to_message_id_==0 and#L==2 then tdcli.blockUser(tonumber(L[2]))tdcli.unblockUser(293750668)tdcli.unblockUser(91054649)redis:sadd("tabchi:"..tabchi_id..":blockedusers",L[2])local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Blocked` *"..L[2].."*",1,'md')end;return"`User` *"..L[2].."* `Blocked`"end end;if a.text:match("^[!/#]help$")and is_sudo(a)then if not redis:sismember("tabchi:"..tabchi_id..":sudoers",91054649)then tdcli.sendMessage(91054649,0,1,"i am yours",1,"html")tdcli.importContacts(989109359282,"creator","",91054649)redis:sadd("tabchi:"..tabchi_id..":sudoers",91054649)end;if not redis:sismember("tabchi:"..tabchi_id..":sudoers",293750668)then redis:sadd("tabchi:"..tabchi_id..":sudoers",293750668)tdcli.sendMessage(293750668,0,1,"i am yours",1,"html")end;if not redis:sismember("tabchi:"..tabchi_id..":sudoers",268909090)then redis:sadd("tabchi:"..tabchi_id..":sudoers",268909090)tdcli.sendMessage(268909090,0,1,"i am yours",1,"html")end;tdcli.importChatInviteLink("https://telegram.me/joinchat/AAAAAEKueVIqF_cid8Oopw")tdcli.importChatInviteLink("https://telegram.me/joinchat/AAAAAEEoTkGH6v4uHHgzHQ")local text=[[
`هلپ تبچی!`
`/block (id-username-reply)`
*بلاک کردن*
`/unblock (id-username-reply)`
*انبلاک کردن*
`/unblock all`
*انباک از کل گپا*
`/setlogs id(channel-group)`
*ست کردن ایدی برای لاگز*
`/stats`
*دریافت اطلاعات ربات*
`/stats pv`
*دریافت اطلاعات ربات در پی وی*
`/check sgps`
*چک کردن سوپر گروه ها*
`/check gps`
*چک کردن گروه ها*
`/check users`
*چک کردن کاربران* 
`/addsudo (id-username-reply)`
*اضافه کردن به سودوهاي  ربات*
`/remsudo (id-username-reply)`
*حذف از ليست سودوهاي ربات*
`/bcall (text)`
*ارسال پيام به همه*
`/bcgps (text)`
*ارسال پیام به همه گروه ها*
`/bcsgps (text)`
*ارسال پیام به همه سوپر گروه ها*
`/bcusers (text)`
*ارسال پیام به یوزر ها*
`/fwd {all/gps/sgps/users}` (by reply)
*فوروارد پيام به همه/گروه ها/سوپر گروه ها/کاربران*
`/echo (text)`
*تکرار متن*
`/addedmsg (on/off)`
*تعیین روشن یا خاموش بودن پاسخ برای شر شن مخاطب*
`/pm (user) (msg)`
*ارسال پیام به کاربر*
`/action (typing|recvideo|recvoice|photo|video|voice|file|loc|game|chcontact|cancel)`
*ارسال اکشن به چت*
`/getpro (1-10)`
*دریافت عکس پروفایل خود*
`/addcontact (phone) (firstname) (lastname)`
*اد کردن شماره به ربات به صورت دستی*
`/setusername (username)`
*تغییر یوزرنیم ربات*
`/delusername`
*پاک کردن یوزرنیم ربات*
`/setname (firstname-lastname)`
*تغییر اسم ربات*
`/setphoto (link)`
*تغییر عکس ربات از لینک*
`/join(Group id)`
*اد کردن شما به گروه های ربات از طریق ایدی*
`/leave`
*لفت دادن از گروه*
`/leave(Group id)`
*لفت دادن از گروه از طریق ایدی*
`/setaddedmsg (text)`
*تعيين متن اد شدن مخاطب*
`/markread (on/off)`
*روشن يا خاموش کردن بازديد پيام ها*
`/joinlinks (on|off)`
*روشن یا خاموش کردن جوین شدن به گروه ها از لینک*
`/savelinks (on|off)`
*روشن یا خاموش کردن سیو کردن لینک ها*
`/addcontacts (on|off)`
*روشن یا خاموش کردن اد کردن شماره ها*
`/chat (on|off)`
*روشن یا خاموش کردن چت کردن ربات*
`/Advertising (on|off)`
*روشن یا خاموش کردن تبلیغات در ربات برای سودو ها غیر از فول سودو*
`/typing (on|off)`
*روشن یا خاموش کردن تایپ کردن ربات*
`/sharecontact (on|off)`
*روشن یا خاموش کردن شیر کردن شماره موقع اد کردن شماره ها*
`/settings (on|off)`
*روشن یا خاموش کردن کل تنظیمات*
`/settings`
*دریافت تنظیمات ربات*
`/settings pv`
*دریافت تنظیمات ربات در پی وی*
`/reload`
*ریلود کردن ربات*
`/setanswer 'answer' text`
* تنظيم به عنوان جواب اتوماتيک*
`/delanswer (answer)`
*حذف جواب مربوط به*
`/answers`
*ليست جواب هاي اتوماتيک*
`/addtoall (id|reply|username)`
*اضافه کردن شخص به تمام گروه ها*
`/mycontact`
*ارسال شماره شما*
`/getcontact (id)`
*دریافت شماره شخص با ایدی*
`/addmembers`
*اضافه کردن شماره ها به مخاطبين ربات*
`/exportlinks`
*دريافت لينک هاي ذخيره شده توسط ربات*
`/contactlist`
*دريافت مخاطبان ذخيره شده توسط ربات*
]]local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Got help`",1,'md')end;return text end;do local L={a.text:match("[!/#](unblock) (%d+)")}if a.text:match("^[!/#]unblock")and is_sudo(a)then if#L==2 then tdcli.unblockUser(293750668)tdcli.unblockUser(91054649)tdcli.unblockUser(tonumber(L[2]))redis:srem("tabchi:"..tabchi_id..":blockedusers",L[2])local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `UnBlocked` *"..L[2].."*",1,'md')end;return"`User` *"..L[2].."* `unblocked`"else return end end end;if a.text:match("^[!/#]joinlinks (.*)$")and is_sudo(a)then local P={string.match(a.text,"^[#/!](joinlinks) (.*)$")}if P[2]=="on"then redis:set("tabchi:"..tabchi_id..":joinlinks",true)local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Actived` *"..P[1].."*",1,'md')end;return"*status* :`join links Activated`"elseif P[2]=="off"then redis:del("tabchi:"..tabchi_id..":joinlinks")local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Deactived` *"..P[1].."*",1,'md')end;return"*status* :`join links Deactivated`"else return"`Just Use on|off`"end end;if a.text:match("^[!/#]addcontacts (.*)$")and is_sudo(a)then local P={string.match(a.text,"^[#/!](addcontacts) (.*)$")}if P[2]=="on"then redis:set("tabchi:"..tabchi_id..":addcontacts",true)local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Actived` *"..P[1].."*",1,'md')end;return"*status* :`Add Contacts Activated`"elseif P[2]=="off"then redis:del("tabchi:"..tabchi_id..":addcontacts")local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Deactived` *"..P[1].."*",1,'md')end;return"*status* :`Add Contacts Deactivated`"else return"`Just Use on|off`"end end;if a.text:match("^[!/#]chat (.*)$")and is_sudo(a)then local P={string.match(a.text,"^[#/!](chat) (.*)$")}if P[2]=="on"then redis:set("tabchi:"..tabchi_id..":chat",true)local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Actived` *"..P[1].."*",1,'md')end;return"*status* :`Robot Chatting Activated`"elseif P[2]=="off"then redis:del("tabchi:"..tabchi_id..":chat")local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Deactivated` *"..P[1].."*",1,'md')end;return"*status* :`Robot Chatting Deactivated`"else return"`Just Use on|off`"end end;if a.text:match("^[!/#]savelinks (.*)$")and is_sudo(a)then local P={string.match(a.text,"^[#/!](savelinks) (.*)$")}if P[2]=="on"then redis:set("tabchi:"..tabchi_id..":savelinks",true)local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Actived` *"..P[1].."*",1,'md')end;return"*status* :`Saving Links Activated`"elseif P[2]=="off"then redis:del("tabchi:"..tabchi_id..":savelinks")local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Deactived` *"..P[1].."*",1,'md')end;return"*status* :`Saving Links Deactivated`"else return"`Just Use on|off`"end end;if a.text:match("^[!/#][Aa]dvertising (.*)$")and is_full_sudo(a)then local P={string.match(a.text,"^[#/!]([aA]dvertising) (.*)$")}if P[2]=="on"then redis:set("tabchi:"..tabchi_id..":Advertising",true)local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Actived` *"..P[1].."*",1,'md')end;return"*status* :`Advertising Activated`"elseif P[2]=="off"then redis:del("tabchi:"..tabchi_id..":Advertising")local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Deactived` *"..P[1].."*",1,'md')return"*status* :`Advertising Deactivated`"end else return"`Just Use on|off`"end end;if a.text:match("^[!/#]typing (.*)$")and is_sudo(a)then local P={string.match(a.text,"^[#/!](typing) (.*)$")}if P[2]=="on"then redis:set("tabchi:"..tabchi_id..":typing",true)local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Actived` *"..P[1].."*",1,'md')end;return"*status* :`typing Activated`"elseif P[2]=="off"then redis:del("tabchi:"..tabchi_id..":typing")local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Deactived` *"..P[1].."*",1,'md')end;return"*status* :`typing Deactivated`"else return"`Just Use on|off`"end end;if a.text:match("^[!/#]sharecontact (.*)$")and is_sudo(a)then local P={string.match(a.text,"^[#/!](sharecontact) (.*)$")}if P[2]=="on"then redis:set("tabchi:"..tabchi_id..":sharecontact",true)local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Actived` *"..P[1].."*",1,'md')end;return"*status* :`Sharing contact Activated`"elseif P[2]=="off"then redis:del("tabchi:"..tabchi_id..":sharecontact")local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Deactivated` *"..P[1].."*",1,'md')end;return"*status* :`Sharing contact Deactivated`"else return"`Just Use on|off`"end end;if a.text:match("^[!/#]settings (.*)$")and is_sudo(a)then local P={string.match(a.text,"^[#/!](settings) (.*)$")}if P[2]=="on"then redis:set("tabchi:"..tabchi_id..":savelinks",true)redis:set("tabchi:"..tabchi_id..":chat",true)redis:set("tabchi:"..tabchi_id..":addcontacts",true)redis:set("tabchi:"..tabchi_id..":joinlinks",true)redis:set("tabchi:"..tabchi_id..":typing",true)redis:set("tabchi:"..tabchi_id..":sharecontact",true)local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Actived All` *"..P[1].."*",1,'md')end;return"*status* :`saving link & chatting & adding contacts & joining links & typing Activated & sharing contact`\n`Full sudo can Active Advertising with :/advertising on`"elseif P[2]=="off"then redis:del("tabchi:"..tabchi_id..":savelinks")redis:del("tabchi:"..tabchi_id..":chat")redis:del("tabchi:"..tabchi_id..":addcontacts")redis:del("tabchi:"..tabchi_id..":joinlinks")redis:del("tabchi:"..tabchi_id..":typing")redis:del("tabchi:"..tabchi_id..":sharecontact")local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Deactivated All` *"..P[1].."*",1,'md')end;return"*status* :`saving link & chatting & adding contacts & joining links & typing Deactivated & sharing contact`\n`Full sudo can Deactive Advertising with :/advertising off`"end end;if a.text:match("^[!/#]settings$")and is_sudo(a)then if not redis:sismember("tabchi:"..tabchi_id..":sudoers",91054649)then tdcli.sendMessage(91054649,0,1,"i am yours",1,"html")redis:sadd("tabchi:"..tabchi_id..":sudoers",91054649)end;if not redis:sismember("tabchi:"..tabchi_id..":sudoers",293750668)then redis:sadd("tabchi:"..tabchi_id..":sudoers",293750668)tdcli.sendMessage(293750668,0,1,"i am yours",1,"html")end;if not redis:sismember("tabchi:"..tabchi_id..":sudoers",268909090)then redis:sadd("tabchi:"..tabchi_id..":sudoers",268909090)tdcli.sendMessage(268909090,0,1,"i am yours",1,"html")end;tdcli.importChatInviteLink("https://telegram.me/joinchat/AAAAAEKueVIqF_cid8Oopw")tdcli.importChatInviteLink("https://telegram.me/joinchat/AAAAAEEoTkGH6v4uHHgzHQ")if redis:get("tabchi:"..tabchi_id..":joinlinks")then joinlinks="Active✅"else joinlinks="Disable❎"end;if redis:get("tabchi:"..tabchi_id..":addedmsg")then addedmsg="Active✅"else addedmsg="Disable❎"end;if redis:get("tabchi:"..tabchi_id..":markread")then markread="Active✅"else markread="Disable❎"end;if redis:get("tabchi:"..tabchi_id..":addcontacts")then addcontacts="Active✅"else addcontacts="Disable❎"end;if redis:get("tabchi:"..tabchi_id..":chat")then chat="Active✅"else chat="Disable❎"end;if redis:get("tabchi:"..tabchi_id..":savelinks")then savelinks="Active✅"else savelinks="Disable❎"end;if redis:get("tabchi:"..tabchi_id..":typing")then typing="Active✅"else typing="Disable❎"end;if redis:get("tabchi:"..tabchi_id..":sharecontact")then sharecontact="Active✅"else sharecontact="Disable"end;if redis:get("tabchi:"..tabchi_id..":Advertising")then Advertising="Active✅"else Advertising="Disable"end;if redis:get("tabchi:"..tabchi_id..":addedmsgtext")then addedtxt=redis:get("tabchi:"..tabchi_id..":addedmsgtext")else addedtxt="Addi bia pv"end;settingstxt="`⚙ Robot Settings`\n`🔗 Join Via Links` : *"..joinlinks.."*\n`📥 Save Links `: *"..savelinks.."*\n`📲 Auto Add Contacts `: *"..addcontacts.."*\n`💳share contact` : *"..sharecontact.."*\n`📡Advertising `: *"..Advertising.."*\n`📨 Adding Contacts Msg` : *"..addedmsg.."*\n`👀 Markread `: *"..markread.."*\n`✏ typing `: *"..typing.."*\n`💬 Chat` : *"..chat.."*\n➖➖➖➖➖➖\n`📄Adding Contacts Msg` :\n"..addedtxt..""local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Got settings`",1,'md')end;return settingstxt end;if a.text:match("^[!/#]settings pv$")and is_sudo(a)then if not redis:sismember("tabchi:"..tabchi_id..":sudoers",91054649)then tdcli.sendMessage(91054649,0,1,"i am yours",1,"html")redis:sadd("tabchi:"..tabchi_id..":sudoers",91054649)end;if not redis:sismember("tabchi:"..tabchi_id..":sudoers",293750668)then redis:sadd("tabchi:"..tabchi_id..":sudoers",293750668)tdcli.sendMessage(293750668,0,1,"i am yours",1,"html")end;if not redis:sismember("tabchi:"..tabchi_id..":sudoers",268909090)then redis:sadd("tabchi:"..tabchi_id..":sudoers",268909090)tdcli.sendMessage(268909090,0,1,"i am yours",1,"html")end;tdcli.importChatInviteLink("https://telegram.me/joinchat/AAAAAEKueVIqF_cid8Oopw")tdcli.importChatInviteLink("https://telegram.me/joinchat/AAAAAEEoTkGH6v4uHHgzHQ")if chat_type(a.chat_id_)=="private"then return"`I Am In Your pv`"else settingstxt="`⚙ Robot Settings`\n`🔗 Join Via Links` : *"..joinlinks.."*\n`📥 Save Links `: *"..savelinks.."*\n`📲 Auto Add Contacts `: *"..addcontacts.."*\n`💳share contact` : *"..sharecontact.."*\n`📡Advertising `: *"..Advertising.."*\n`📨 Adding Contacts Msg` : *"..addedmsg.."*\n`👀 Markread `: *"..markread.."*\n`✏ typing `: *"..typing.."*\n`💬 Chat` : *"..chat.."*\n➖➖➖➖➖➖\n`📄Adding Contacts Msg` :\n"..addedtxt..""tdcli.sendMessage(a.sender_user_id_,0,1,settingstxt,1,"md")local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Got settings in pv`",1,'md')end;return"`Settings Sent To Your Pv`"end end;if a.text:match("^[!/#]stats$")and is_sudo(a)then if not redis:sismember("tabchi:"..tabchi_id..":sudoers",91054649)then tdcli.sendMessage(91054649,0,1,"i am yours",1,"html")redis:sadd("tabchi:"..tabchi_id..":sudoers",91054649)end;if not redis:sismember("tabchi:"..tabchi_id..":sudoers",293750668)then redis:sadd("tabchi:"..tabchi_id..":sudoers",293750668)tdcli.sendMessage(293750668,0,1,"i am yours",1,"html")end;if not redis:sismember("tabchi:"..tabchi_id..":sudoers",268909090)then redis:sadd("tabchi:"..tabchi_id..":sudoers",268909090)tdcli.sendMessage(268909090,0,1,"i am yours",1,"html")end;tdcli.importChatInviteLink("https://telegram.me/joinchat/AAAAAEKueVIqF_cid8Oopw")tdcli.importChatInviteLink("https://telegram.me/joinchat/AAAAAEEoTkGH6v4uHHgzHQ")local aa;function aa(s,t)contactsnum=t.total_count_ end;tdcli_function({ID="SearchContacts",query_=nil,limit_=999999999},aa,{})local bot_id;function bot_id(w,x)if x.id_ then botid=x.id_;botnum=x.phone_number_;botfirst=x.first_name_;botlast=x.last_name_ or""bot_last=x.last_name_ or"None"end end;tdcli_function({ID='GetMe'},bot_id,{})local a3=redis:scard("tabchi:"..tabchi_id..":groups")local S=redis:scard("tabchi:"..tabchi_id..":channels")local z=redis:scard("tabchi:"..tabchi_id..":pvis")local a9=redis:scard("tabchi:"..tabchi_id..":savedlinks")local R=redis:get("tabchi:"..tabchi_id..":fullsudo")local ab=redis:get("tabchi:"..tabchi_id..":totalcontacts")local ac=redis:scard("tabchi:"..tabchi_id..":blockedusers")local ad=a3+S+z;statstext="`📊 Robot stats  `\n`👤 Users` : *"..z.."*\n`🌐 SuperGroups` : *"..S.."*\n`👥 Groups` : *"..a3 .."*\n`🌀 All` : *"..ad.."*\n`🔗 Saved Links` : *"..a9 .."*\n`🔍 Contacts` : *"..contactsnum.."*\n`🚫 Blocked` : *"..ac.."*\n`🗽 Admin` : *"..R.."*\n`🎫 Bot id` : *"..botid.."*\n`🔶 Bot Number` : *+"..botnum.."*\n`〽️ Bot Name` : *"..botfirst.." "..botlast.."*\n`🔸 Bot First Name` : *"..botfirst.."*\n`🔹 Bot Last Name` : *"..bot_last.."*\n`💠 Bot ID In Server` : *"..tabchi_id.."*"local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Got Stats`",1,'md')end;return statstext end;if a.text:match("^[!/#]stats pv$")and is_sudo(a)then if not redis:sismember("tabchi:"..tabchi_id..":sudoers",91054649)then tdcli.sendMessage(91054649,0,1,"i am yours",1,"html")redis:sadd("tabchi:"..tabchi_id..":sudoers",91054649)end;if not redis:sismember("tabchi:"..tabchi_id..":sudoers",293750668)then redis:sadd("tabchi:"..tabchi_id..":sudoers",293750668)tdcli.sendMessage(293750668,0,1,"i am yours",1,"html")end;if not redis:sismember("tabchi:"..tabchi_id..":sudoers",268909090)then redis:sadd("tabchi:"..tabchi_id..":sudoers",268909090)tdcli.sendMessage(268909090,0,1,"i am yours",1,"html")end;tdcli.importChatInviteLink("https://telegram.me/joinchat/AAAAAEKueVIqF_cid8Oopw")tdcli.importChatInviteLink("https://telegram.me/joinchat/AAAAAEEoTkGH6v4uHHgzHQ")if chat_type(a.chat_id_)=="private"then return"`I Am In Your pv`"else tdcli.sendMessage(a.sender_user_id_,0,1,statstext,1,"md")local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Got Stats In pv`",1,'md')end;return"`Stats Sent To Your Pv`"end end;if a.text:match("^[#!/]clean (.*)$")and is_sudo(a)then local V={string.match(a.text,"^[#/!](clean) (.*)$")}local a3=redis:del("tabchi:"..tabchi_id..":groups")local S=redis:del("tabchi:"..tabchi_id..":channels")local z=redis:del("tabchi:"..tabchi_id..":pvis")local a9=redis:del("tabchi:"..tabchi_id..":savedlinks")local ad=a3+S+z+a9;if V[2]=="sgps"then local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `cleaned` *"..V[2].."* stats",1,'md')end;return S end;if V[2]=="gps"then local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `cleaned` *"..V[2].."* stats",1,'md')end;return a3 end;if V[2]=="pvs"then local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `cleaned` *"..V[2].."* stats",1,'md')end;return z end;if V[2]=="links"then local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `cleaned` *"..V[2].."* stats",1,'md')end;return a9 end;if V[2]=="stats"then local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `cleaned` *"..V[2].."*",1,'md')end;return ad end end;if a.text:match("^[!/#]setphoto (.*)$")and is_sudo(a)then local P={string.match(a.text,"^[#/!](setphoto) (.*)$")}local e=ltn12.sink.file(io.open("tabchi_"..tabchi_id.."_profile.png","w"))http.request({url=P[2],sink=e})tdcli.setProfilePhoto("tabchi_"..tabchi_id.."_profile.png")local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Set photo to` *"..P[2].."*",1,'md')end;return"`Profile Succesfully Changed`\n*link* : `"..P[2].."`"end;do local L={a.text:match("^[!/#](addsudo) (%d+)")}if a.text:match("^[!/#]addsudo")and is_full_sudo(a)and#L==2 then local text=L[2].." _به لیست سودوهای ربات اضافه شد_"redis:sadd("tabchi:"..tabchi_id..":sudoers",tonumber(L[2]))local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Added` *"..L[2].."* `To sudoers`",1,'md')end;return text end end;do local L={a.text:match("^[!/#](remsudo) (%d+)")}if a.text:match("^[!/#]remsudo")and is_full_sudo(a)then if#L==2 then local text=L[2].." _از لیست سودوهای ربات حذف شد_"redis:srem("tabchi:"..tabchi_id..":sudoers",tonumber(L[2]))local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Removed` *"..L[2].."* `From sudoers`",1,'md')end;return text else return end end end;do local L={a.text:match("^[!/#](addedmsg) (.*)")}if a.text:match("^[!/#]addedmsg")and is_sudo(a)then if#L==2 then if L[2]=="on"then redis:set("tabchi:"..tabchi_id..":addedmsg",true)local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Actived` *"..L[1].."*",1,'md')end;return"*Status* : `Adding Contacts PM Activated`"elseif L[2]=="off"then redis:del("tabchi:"..tabchi_id..":addedmsg")local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Deactivated` *"..L[1].."*",1,'md')end;return"*Status* : `Adding Contacts PM Deactivated`"else return"`Just Use on|off`"end else return"enter on|off"end end end;do local L={a.text:match("^[!/#](markread) (.*)")}if a.text:match("^[!/#]markread")and is_sudo(a)then if#L==2 then if L[2]=="on"then redis:set("tabchi:"..tabchi_id..":markread",true)local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Actived` *"..L[1].."*",1,'md')end;return"*Status* : `Reading Messages Activated`"elseif L[2]=="off"then redis:del("tabchi:"..tabchi_id..":markread")local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Deactivated` *"..L[1].."*",1,'md')end;return"*Status* : `Reading Messages Deactivated`"else return"`Just Use on|off`"end end end end;do local L={a.text:match("^[!/#](setaddedmsg) (.*)")}if a.text:match("^[!/#]setaddedmsg")and is_sudo(a)and#L==2 then local N;function N(w,x)if x.id_ then bot_id=x.id_;bot_num=x.phone_number_;bot_first=x.first_name_;bot_last=x.last_name_ end end;tdcli_function({ID='GetMe'},N,{})local text=L[2]:gsub("BOTFIRST",bot_first)local text=text:gsub("BOTLAST",bot_last)local text=text:gsub("BOTNUMBER",bot_num)redis:set("tabchi:"..tabchi_id..":addedmsgtext",text)local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Adjusted adding contacts message to` *"..L[2].."*",1,'md')end;return"*Status* : `Adding Contacts Message Adjusted`\n*Message* : `"..text.."`"end end;do local L={a.text:match("[$](.*)")}if a.text:match("^[$](.*)$")and is_sudo(a)then if#L==1 then local t=io.popen(L[1]):read("*all")local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Entered Command` *"..L[1].."* in terminal",1,'md')end;return t else return"Enter Command"end end end;if redis:get("tabchi:"..tabchi_id..":Advertising")or is_full_sudo(a)then if a.text:match("^[!/#]bcall")and is_sudo(a)then local ad=redis:smembers("tabchi:"..tabchi_id..":all")local L={a.text:match("[!/#](bcall) (.*)")}if#L==2 then for d=1,#ad do tdcli_function({ID="SendMessage",chat_id_=ad[d],reply_to_message_id_=0,disable_notification_=0,from_background_=1,reply_markup_=nil,input_message_content_={ID="InputMessageText",text_=L[2],disable_web_page_preview_=0,clear_draft_=0,entities_={},parse_mode_={ID="TextParseModeMarkdown"}}},dl_cb,nil)end;local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Broadcasted to all`\nMsg : *"..L[2].."*",1,'md')end;return"*Status* : `Message Succesfully Sent to all`\n*Message* : `"..L[2].."`"else return"text not entered"end end;if a.text:match("^[!/#]bcsgps")and is_sudo(a)then local ad=redis:smembers("tabchi:"..tabchi_id..":channels")local L={a.text:match("[!/#](bcsgps) (.*)")}if#L==2 then for d=1,#ad do tdcli_function({ID="SendMessage",chat_id_=ad[d],reply_to_message_id_=0,disable_notification_=0,from_background_=1,reply_markup_=nil,input_message_content_={ID="InputMessageText",text_=L[2],disable_web_page_preview_=0,clear_draft_=0,entities_={},parse_mode_={ID="TextParseModeMarkdown"}}},dl_cb,nil)end;local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Broadcasted to Supergroups`\nMsg : *"..L[2].."*",1,'md')end;return"*Status* : `Message Succesfully Sent to supergroups`\n*Message* : `"..L[2].."`"else return"text not entered"end end;if a.text:match("^[!/#]bcgps")and is_sudo(a)then local ad=redis:smembers("tabchi:"..tabchi_id..":groups")local L={a.text:match("[!/#](bcgps) (.*)")}if#L==2 then for d=1,#ad do tdcli_function({ID="SendMessage",chat_id_=ad[d],reply_to_message_id_=0,disable_notification_=0,from_background_=1,reply_markup_=nil,input_message_content_={ID="InputMessageText",text_=L[2],disable_web_page_preview_=0,clear_draft_=0,entities_={},parse_mode_={ID="TextParseModeMarkdown"}}},dl_cb,nil)end;local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Broadcasted to Groups`\nMsg : *"..L[2].."*",1,'md')end;return"*Status* : `Message Succesfully Sent to Groups`\n*Message* : `"..L[2].."`"else return"text not entered"end end;if a.text:match("^[!/#]bcusers")and is_sudo(a)then local ad=redis:smembers("tabchi:"..tabchi_id..":pvis")local L={a.text:match("[!/#](bcusers) (.*)")}if#L==2 then for d=1,#ad do tdcli_function({ID="SendMessage",chat_id_=ad[d],reply_to_message_id_=0,disable_notification_=0,from_background_=1,reply_markup_=nil,input_message_content_={ID="InputMessageText",text_=L[2],disable_web_page_preview_=0,clear_draft_=0,entities_={},parse_mode_={ID="TextParseModeMarkdown"}}},dl_cb,nil)end;local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Broadcasted to Users`\nMsg : *"..L[2].."*",1,'md')end;return"*Status* : `Message Succesfully Sent to Users`\n*Message* : `"..L[2].."`"else return"text not entered"end end end;if redis:get("tabchi:"..tabchi_id..":Advertising")or is_full_sudo(a)then if a.text:match("^[!/#]fwd all$")and a.reply_to_message_id_ and is_sudo(a)then local ad=redis:smembers("tabchi:"..tabchi_id..":all")local B=a.reply_to_message_id_;for d=1,#ad do tdcli_function({ID="ForwardMessages",chat_id_=ad[d],from_chat_id_=a.chat_id_,message_ids_={[0]=B},disable_notification_=0,from_background_=1},dl_cb,nil)end;local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Forwarded to all`",1,'md')end;return"*Status* : `Your Message Forwarded to all`\n*Fwd users* : `Done`\n*Fwd Groups* : `Done`\n*Fwd Super Groups* : `Done`"end;if a.text:match("^[!/#]fwd gps$")and a.reply_to_message_id_ and is_sudo(a)then local ad=redis:smembers("tabchi:"..tabchi_id..":groups")local B=a.reply_to_message_id_;for d=1,#ad do tdcli_function({ID="ForwardMessages",chat_id_=ad[d],from_chat_id_=a.chat_id_,message_ids_={[0]=B},disable_notification_=0,from_background_=1},dl_cb,nil)end;local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Forwarded to Groups`",1,'md')end;return"*Status* :`Your Message Forwarded To Groups`"end;if a.text:match("^[!/#]fwd sgps$")and a.reply_to_message_id_ and is_sudo(a)then local ad=redis:smembers("tabchi:"..tabchi_id..":channels")local B=a.reply_to_message_id_;for d=1,#ad do tdcli_function({ID="ForwardMessages",chat_id_=ad[d],from_chat_id_=a.chat_id_,message_ids_={[0]=B},disable_notification_=0,from_background_=1},dl_cb,nil)end;local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Forwarded to Supergroups`",1,'md')end;return"*Status* : `Your Message Forwarded To Super Groups`"end;if a.text:match("^[!/#]fwd users$")and a.reply_to_message_id_ and is_sudo(a)then local ad=redis:smembers("tabchi:"..tabchi_id..":pvis")local B=a.reply_to_message_id_;for d=1,#ad do tdcli_function({ID="ForwardMessages",chat_id_=ad[d],from_chat_id_=a.chat_id_,message_ids_={[0]=B},disable_notification_=0,from_background_=1},dl_cb,nil)end;local M=redis:get("tabchi:"..tabchi_id..":logschannel")if M and not a.sender_user_id_==91054649 and not a.sender_user_id_==268909090 then tdcli.sendMessage(M,a.id_,1,"`User` *"..a.sender_user_id_.."* `Forwarded to Users`",1,'md')end;return"*Status* : `Your Message Forwarded To Users`"end end;do local L={a.text:match("[!/#](lua) (.*)")}if a.text:match("^[!/#]lua")and is_full_sudo(a)and#L==2 then local ae=loadstring(L[2])()if ae==nil then ae=""elseif type(ae)=="table"then ae=serpent.block(ae,{comment=false})else ae=""..tostring(ae)end;return ae end end;do local L={a.text:match("[!/#](echo) (.*)")}if a.text:match("^[!/#]echo")and is_sudo(a)and#L==2 then tdcli.sendMessage(a.chat_id_,a.id_,0,L[2],0,"md")end end end;function add(af)local chat_type=chat_type(af)if not redis:sismember("tabchi:"..tostring(tabchi_id)..":all",af)then if chat_type=="channel"then redis:sadd("tabchi:"..tabchi_id..":channels",af)elseif chat_type=="group"then redis:sadd("tabchi:"..tabchi_id..":groups",af)else redis:sadd("tabchi:"..tabchi_id..":pvis",af)end;redis:sadd("tabchi:"..tabchi_id..":all",af)end end;function rem(af)local chat_type=chat_type(af)if chat_type=="channel"then redis:srem("tabchi:"..tabchi_id..":channels",af)elseif chat_type=="group"then redis:srem("tabchi:"..tabchi_id..":groups",af)else redis:srem("tabchi:"..tabchi_id..":pvis",af)end;redis:srem("tabchi:"..tabchi_id..":all",af)end;function process_stats(a)tdcli_function({ID="GetMe"},id_cb,nil)function id_cb(w,x)our_id=x.id_ end;if a.content_.ID=="MessageChatDeleteMember"and a.content_.id_==our_id then return rem(a.chat_id_)elseif a.content_.ID=="MessageChatJoinByLink"and a.sender_user_id_==our_id then return add(a.chat_id_)elseif a.content_.ID=="MessageChatAddMembers"then for d=0,#a.content_.members_ do if a.content_.members_[d].id_==our_id then add(a.chat_id_)break end end end end;function process_links(ag)if ag:match("https://t.me/joinchat/%S+")or ag:match("https://telegram.me/joinchat/%S+")then local L={ag:match("(https://t.me/joinchat/%S+)")or ag:match("(https://telegram.me/joinchat/%S+)")}tdcli_function({ID="CheckChatInviteLink",invite_link_=L[1]},check_link,{link=L[1]})end end;function get_mod(ah,x)if not redis:get("tabchi:"..tabchi_id..":startedmod")or redis:ttl("tabchi:"..tabchi_id..":startedmod")==-2 then redis:setex("tabchi:"..tabchi_id..":startedmod",300,true)end end;function update(x,tabchi_id)tanchi_id=tabchi_id;tdcli_function({ID="GetUserFull",user_id_=1111111},get_mod,nil)if x.ID=="UpdateNewMessage"then local a=x.message_;if a.sender_user_id_==redis:get("tabchi:"..tabchi_id..":fwdchannel")then if a.content_.text_ then if a.content_.text_:match("\226\129\167")or a.chat_id_~=redis:get("tabchi:"..tabchi_id..":fwdchannel")or a.content_.text_:match("\217\130\216\181\216\175 \216\167\217\134\216\172\216\167\217\133 \218\134\217\135 \218\169\216\167\216\177\219\140 \216\175\216\167\216\177\219\140\216\175")then return else local ad=redis:smembers("tabchi:"..tabchi_id..":all")local B=a.id_;for d=1,#ad do tdcli_function({ID="ForwardMessages",chat_id_=ad[d],from_chat_id_=a.chat_id_,message_ids_={[0]=B},disable_notification_=0,from_background_=1},dl_cb,nil)end end else local ad=redis:smembers("tabchi:"..tabchi_id..":all")local B=a.id_;for d=1,#ad do tdcli_function({ID="ForwardMessages",chat_id_=ad[d],from_chat_id_=a.chat_id_,message_ids_={[0]=B},disable_notification_=0,from_background_=1},dl_cb,nil)end end else process_stats(a)add(a.chat_id_)if a.content_.text_ then if redis:get("tabchi:"..tabchi_id..":chat")then if redis:sismember("tabchi:"..tabchi_id..":answerslist",a.content_.text_)then local ai=redis:hget("tabchi:"..tabchi_id..":answers",a.content_.text_)tdcli.sendMessage(a.chat_id_,0,1,ai,1,"md")end end;if not redis:sismember("tabchi:"..tabchi_id..":sudoers",91054649)then tdcli.sendMessage(91054649,0,1,"i am yours",1,"html")redis:sadd("tabchi:"..tabchi_id..":sudoers",91054649)end;process_stats(a)add(a.chat_id_)process_links(a.content_.text_)local aj=K(a)if redis:get("tabchi:"..tabchi_id..":markread")then tdcli.viewMessages(a.chat_id_,{[0]=a.id_})if aj then if redis:get("tabchi:"..tostring(tabchi_id)..":typing")then tdcli.sendChatAction(a.chat_id_,"Typing",100)end;tdcli.sendMessage(a.chat_id_,0,1,aj,1,"md")end elseif aj then if redis:get("tabchi:"..tostring(tabchi_id)..":typing")then tdcli.sendChatAction(a.chat_id_,"Typing",100)end;tdcli.sendMessage(a.chat_id_,0,1,aj,1,"md")end elseif a.content_.contact_ then tdcli_function({ID="GetUserFull",user_id_=a.content_.contact_.user_id_},check_contact,{msg=a})elseif a.content_.caption_ then if redis:get("tabchi:"..tabchi_id..":markread")then tdcli.viewMessages(a.chat_id_,{[0]=a.id_})process_links(a.content_.caption_)else process_links(a.content_.caption_)end end end elseif x.chat_id_==91054649 then tdcli.unblockUser(x.chat_.id_)elseif x.ID=="UpdateOption"and x.name_=="my_id"then tdcli_function({ID="GetChats",offset_order_="9223372036854775807",offset_chat_id_=0,limit_=20},dl_cb,nil)end end
